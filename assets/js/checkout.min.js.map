{"version":3,"sources":["checkout.js"],"names":["window","rp","Reepay","ModalCheckout","jQuery","$","wc_checkout_params","document","ajaxComplete","event","xhr","settings","url","checkout_url","indexOf","data","responseText","result","parseJSON","hasOwnProperty","wc_reepay","buildModalCheckout","reepay","id","accept_url","e","console","warn","ready","location","hash","replace","params","URLSearchParams","rid","get","setTimeout","history","pushState","title","pathname","reepay_id","WC_Gateway_Reepay_Checkout","payment_type","show","WindowCheckout","addEventHandler","Event","Accept","log","redirect_url","prop","setUrlParameter","href","Cancel","throw_error","cancel_text","Close","removeClass","unblock","Error","error_text","errorThrown","form","remove","message","before","scrollElement","length","animate","scrollTop","offset","top","key","value","baseUrl","split","urlQueryString","newParam","updateRegex","RegExp","removeRegex","match"],"mappings":"AAIAA,OAAOC,GAAK,IAAIC,OAAOC,cAEvBC,QAAQ,SAAUC,GACd,aAGA,GAAmC,oBAAvBC,mBACR,OAAO,EAGXD,EAAGE,UAAWC,cAAc,SAAWC,EAAOC,EAAKC,GAC/C,GAAOA,EAASC,MAAQN,mBAAmBO,cAAoBF,EAASC,IAAIE,QAAS,2BAA8B,EAAM,CACrH,MAAMC,EAAOL,EAAIM,aAGjB,IACI,MAAMC,EAASZ,EAAEa,UAAWH,GAG5B,IAAOE,EAAOE,eAAgB,sBAC1B,OAAO,EAGXC,UAAUC,mBAAoBJ,EAAOK,OAAOC,GAAIN,EAAOO,YACzD,MAAQC,GAGN,OAFAC,QAAQC,KAAMF,IAEP,OAKnBpB,EAAGE,UAAWqB,OAAM,WAChB,GAAK5B,OAAO6B,SAASC,KAAKhB,QAAS,iBAAoB,EAAI,CACvD,MAAMF,EAAML,SAASsB,SAASC,KAAKC,QAAS,eAAe,IACvDC,EAAS,IAAIC,gBAAiBrB,GAElC,IAAIsB,EAAMF,EAAOG,IAAK,OAClBX,EAAaQ,EAAOG,IAAK,cAE7BnC,OAAOoC,YAAY,WACfhB,UAAUC,mBAAoBa,EAAKV,GACnCa,QAAQC,UAAW,GAAI/B,SAASgC,MAAOvC,OAAO6B,SAASW,YACxD,YAKfpB,UAAY,CAORC,mBAAoB,SAAWoB,EAAWjB,GACW,YAA5CkB,2BAA2BC,aAE5B3C,OAAOC,GAAG2C,KAAMH,GAGhBzC,OAAOC,GAAK,IAAIC,OAAO2C,eAAgBJ,GAG3CzC,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMC,QAAQ,SAAUjC,GACtDW,QAAQuB,IAAK,SAAUlC,GAEvB,IAAImC,EAAe1B,EACnB,IAAM,IAAI2B,KAAQpC,EACdmC,EAAe9B,UAAUgC,gBAAiBF,EAAcC,EAAMpC,EAAKoC,IAGvEnD,OAAO6B,SAASwB,KAAOH,KAG3BlD,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMO,QAAQ,SAAUvC,GACtDW,QAAQuB,IAAK,SAAUlC,GACvBK,UAAUmC,YAAab,2BAA2Bc,gBAGtDxD,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMU,OAAO,SAAU1C,GAC1CV,EAAE,iBACRqD,YAAa,cAAeC,UACjCjC,QAAQuB,IAAK,QAASlC,MAG1Bf,OAAOC,GAAG6C,gBAAiB5C,OAAO6C,MAAMa,OAAO,SAAU7C,GACrDW,QAAQuB,IAAK,QAASlC,GACtBK,UAAUmC,YAAab,2BAA2BmB,gBAI1DN,YAAa,SAAWO,GACpB1D,QAAQ,SAAUC,GACd,IAAI0D,EAAO1D,EAAE,iBACb0D,EAAKL,YAAa,cAAeC,UACjCtD,EAAE,4BAA4B2D,SAC9B,IAAIC,EAAU,wHAA0HH,EAAc,mBACtJC,EAAKG,OAAOD,GACZ,IAAIE,EAAgB9D,EAAE,iFACjB8D,EAAcC,SACfD,EAAgB9D,EAAE,mBAElB8D,EAAcC,QACd/D,EAAE,cAAcgE,QAAQ,CACpBC,UAAYH,EAAcI,SAASC,IAAM,KAC1C,SAcfpB,gBAAiB,SAAWxC,EAAK6D,EAAKC,GAClC,IAAIC,EAAU/D,EAAIgE,MAAM,KAAK,GACzBC,EAAiB,IAAMjE,EAAIgE,MAAM,KAAK,GACtCE,EAAWL,EAAM,IAAMC,EACvB1C,EAAS,IAAM8C,EAGnB,GAAID,EAAgB,CAChB,IAAIE,EAAc,IAAIC,OAAO,SAAYP,EAAM,SAC3CQ,EAAc,IAAID,OAAO,SAAYP,EAAM,gBAI3CzC,EAFA,MAAO0C,GAAqD,KAAVA,GAClD1C,EAAS6C,EAAe9C,QAAQkD,EAAa,OAC7BlD,QAAQ,QAAS,IAEY,OAAtC8C,EAAeK,MAAMH,GACnBF,EAAe9C,QAAQgD,EAAa,KAAOD,GAG3CD,EAAiB,IAAMC,EAOxC,OAAOH,GAFP3C,EAAoB,MAAXA,EAAiB,GAAKA","file":"checkout.min.js","sourcesContent":["/* global wc_checkout_params */\r\n/* global Reepay */\r\n\r\n// Preload ModalCheckout\r\nwindow.rp = new Reepay.ModalCheckout();\r\n\r\njQuery( function( $ ) {\r\n    'use strict';\r\n\r\n    // wc_checkout_params is required to continue, ensure the object exists\r\n    if ( typeof wc_checkout_params === 'undefined' ) {\r\n        return false;\r\n    }\r\n\r\n    $( document ).ajaxComplete( function ( event, xhr, settings ) {\r\n        if ( ( settings.url === wc_checkout_params.checkout_url ) || ( settings.url.indexOf( 'wc-ajax=complete_order' ) > -1 ) ) {\r\n            const data = xhr.responseText;\r\n\r\n            // Parse\r\n            try {\r\n                const result = $.parseJSON( data );\r\n\r\n                // Check is response from payment gateway\r\n                if ( ! result.hasOwnProperty( 'is_reepay_checkout' ) ) {\r\n                    return false;\r\n                }\r\n\r\n                wc_reepay.buildModalCheckout( result.reepay.id, result.accept_url );\r\n            } catch ( e ) {\r\n                console.warn( e );\r\n\r\n                return false;\r\n            }\r\n        }\r\n    } );\r\n\r\n    $( document ).ready(function () {\r\n        if ( window.location.hash.indexOf( '#!reepay-pay' ) > -1 ) {\r\n            const url = document.location.hash.replace( '#!reepay-pay','' ),\r\n                params = new URLSearchParams( url );\r\n\r\n            let rid = params.get( 'rid' ),\r\n                accept_url = params.get( 'accept_url' );\r\n\r\n            window.setTimeout( function () {\r\n                wc_reepay.buildModalCheckout( rid, accept_url );\r\n                history.pushState( '', document.title, window.location.pathname );\r\n            }, 1000 );\r\n        }\r\n    });\r\n});\r\n\r\nwc_reepay = {\r\n    /**\r\n     * Build Modal Checkout\r\n     *\r\n     * @param reepay_id\r\n     * @param accept_url\r\n     */\r\n    buildModalCheckout: function ( reepay_id, accept_url ) {\r\n        if ( WC_Gateway_Reepay_Checkout.payment_type === 'OVERLAY' ) {\r\n            // Show modal\r\n            window.rp.show( reepay_id );\r\n            //rp = new Reepay.ModalCheckout( reepay_id );\r\n        } else {\r\n            window.rp = new Reepay.WindowCheckout( reepay_id );\r\n        }\r\n\r\n        window.rp.addEventHandler( Reepay.Event.Accept, function( data ) {\r\n            console.log( 'Accept', data );\r\n\r\n            let redirect_url = accept_url;\r\n            for ( let prop in data ) {\r\n                redirect_url = wc_reepay.setUrlParameter( redirect_url, prop, data[prop] );\r\n            }\r\n\r\n            window.location.href = redirect_url;\r\n        } );\r\n\r\n        window.rp.addEventHandler( Reepay.Event.Cancel, function( data ) {\r\n            console.log( 'Cancel', data );\r\n            wc_reepay.throw_error( WC_Gateway_Reepay_Checkout.cancel_text )\r\n        } );\r\n\r\n        window.rp.addEventHandler( Reepay.Event.Close, function( data ) {\r\n            var form = $('form.checkout');\r\n            form.removeClass( 'processing' ).unblock();\r\n            console.log( 'Close', data );\r\n        } );\r\n\r\n        window.rp.addEventHandler( Reepay.Event.Error, function( data ) {\r\n            console.log( 'Error', data );\r\n            wc_reepay.throw_error( WC_Gateway_Reepay_Checkout.error_text )\r\n        } );\r\n    },\r\n\r\n    throw_error: function ( errorThrown ) {\r\n        jQuery( function( $ ) {\r\n            var form = $('form.checkout');\r\n            form.removeClass( 'processing' ).unblock();\r\n            $('.woocommerce-NoticeGroup').remove();\r\n            var message = '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\"><ul class=\"woocommerce-error\" role=\"alert\"><li>' + errorThrown + '</li></ul></div>';\r\n            form.before(message);\r\n            var scrollElement = $('.woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout');\r\n            if (!scrollElement.length) {\r\n                scrollElement = $('.form.checkout');\r\n            }\r\n            if (scrollElement.length) {\r\n                $('html, body').animate({\r\n                    scrollTop: (scrollElement.offset().top - 100)\r\n                }, 1000);\r\n            }\r\n        });\r\n    },\r\n\r\n\r\n/**\r\n     * Add parameter for Url\r\n     *\r\n     * @param url\r\n     * @param key\r\n     * @param value\r\n     * @return {string}\r\n     */\r\n    setUrlParameter: function ( url, key, value ) {\r\n        var baseUrl = url.split('?')[0],\r\n            urlQueryString = '?' + url.split('?')[1],\r\n            newParam = key + '=' + value,\r\n            params = '?' + newParam;\r\n\r\n        // If the \"search\" string exists, then build params from it\r\n        if (urlQueryString) {\r\n            var updateRegex = new RegExp('([\\?&])' + key + '[^&]*');\r\n            var removeRegex = new RegExp('([\\?&])' + key + '=[^&;]+[&;]?');\r\n\r\n            if (typeof value === 'undefined' || value === null || value === '') { // Remove param if value is empty\r\n                params = urlQueryString.replace(removeRegex, \"$1\");\r\n                params = params.replace(/[&;]$/, \"\");\r\n\r\n            } else if (urlQueryString.match(updateRegex) !== null) { // If param exists already, update it\r\n                params = urlQueryString.replace(updateRegex, \"$1\" + newParam);\r\n\r\n            } else { // Otherwise, add it to end of query string\r\n                params = urlQueryString + '&' + newParam;\r\n            }\r\n        }\r\n\r\n        // no parameter was set so we don't need the question mark\r\n        params = params === '?' ? '' : params;\r\n\r\n        return baseUrl + params;\r\n    }\r\n};\r\n\r\n"]}